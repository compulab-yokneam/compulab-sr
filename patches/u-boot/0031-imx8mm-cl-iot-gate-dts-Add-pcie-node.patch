From 624581b6d906440e69b5f0e22d8ca1df89bdcbff Mon Sep 17 00:00:00 2001
From: Valentin Raevsky <valentin@compulab.co.il>
Date: Sat, 28 Aug 2021 11:35:40 +0300
Subject: [PATCH 31/31] imx8mm-cl-iot-gate: dts: Add pcie node

Signed-off-by: Valentin Raevsky <valentin@compulab.co.il>
---
 arch/arm/dts/imx8mm-cl-iot-gate.dts | 31 +++++++++++++++++++++++++++++
 1 file changed, 31 insertions(+)

diff --git a/arch/arm/dts/imx8mm-cl-iot-gate.dts b/arch/arm/dts/imx8mm-cl-iot-gate.dts
index 11d477e6d7..0858f370ed 100644
--- a/arch/arm/dts/imx8mm-cl-iot-gate.dts
+++ b/arch/arm/dts/imx8mm-cl-iot-gate.dts
@@ -64,6 +64,12 @@
 		startup-delay-us = <100>;
 		off-on-delay-us = <12000>;
 	};
+
+	pcie0_refclk: pcie0-refclk {
+		compatible = "fixed-clock";
+		#clock-cells = <0>;
+		clock-frequency = <100000000>;
+	};
 };
 
 &ddrc {
@@ -362,6 +368,31 @@
 	status = "okay";
 };
 
+&pcie0 {
+	/delete-property/ power-domains;
+	compatible = "fsl,imx7d-pcie", "snps,dw-pcie";
+	clocks = <&clk IMX8MM_CLK_PCIE1_ROOT>,
+		 <&clk IMX8MM_CLK_PCIE1_AUX>,
+		 <&clk IMX8MM_CLK_PCIE1_PHY>,
+		 <&pcie0_refclk>;
+	clock-names = "pcie", "pcie_aux", "pcie_phy", "pcie_bus";
+	assigned-clocks = <&clk IMX8MM_CLK_PCIE1_AUX>,
+			  <&clk IMX8MM_CLK_PCIE1_PHY>,
+			  <&clk IMX8MM_CLK_PCIE1_CTRL>;
+	assigned-clock-rates = <10000000>, <100000000>, <250000000>;
+	assigned-clock-parents = <&clk IMX8MM_SYS_PLL2_50M>,
+				 <&clk IMX8MM_SYS_PLL2_100M>,
+				 <&clk IMX8MM_SYS_PLL2_250M>;
+	ext_osc = <1>;
+	status = "disabled";
+};
+
+&pcie0_ep {
+	/delete-property/ power-domains;
+	compatible = "snps,dw-pcie-ep";
+	status = "disabled";
+};
+
 &iomuxc {
 	pinctrl-names = "default";
 	pinctrl-0 = <&pinctrl_hog>;
-- 
2.17.1

